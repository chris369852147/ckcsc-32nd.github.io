
///// nameCard.js /////
(function($){
	console.log('nameCard loaded');		
	$.fn.nameCard = function(data){
		var ctx = this[0].getContext('2d');
		if(!data) data = {};
		var preData = {
			name: '吳政儒',
			nickName: '狸貓',
			job: '社長 社寵'
		};
		for(var i in preData){
			if(!(i in data)){
				data[i] = preData[i];
			}
		}
	
		ctx.fillStyle = '#1b2124';
		ctx.fillRect(0,0,900,540);
		ctx.fillStyle = '#ffffff';
		ctx.font = '120px Auraka點陣宋';
		ctx.fillText(data.name,30,130);
		ctx.font = '60px Auraka點陣宋';
		ctx.fillText(data.job,420,80);
		ctx.font = '50px Auraka點陣宋';
		ctx.fillText(data.nickName,420,150)
	}
})($);
///// avatar.js /////
(function($){
	debugger;
	console.log('avatar loaded');
	function black(x, y, ctx){
		var size = 16;
		var rawX = x * size;
		var rawY = 128 - size * (y + 1);
		// console.table({x: rawX, y: rawY});
		ctx.fillRect(rawX, rawY, size, size);
	}
			
	function clear(ctx, bgColor){
		var tmp = ctx.fillStyle;
		ctx.fillStyle = bgColor;
		ctx.fillRect(0, 0, 128, 128);
		ctx.fillStyle = tmp;
	}

	function generate(ctx, color, bgColor){
		clear(ctx, bgColor);
		var tmp = ctx.fillStyle;
		ctx.fillStyle = color;

		var list = [7,6,5,4];
		for(var i = 0; i < 8; i++){
			for(var j in list){
				if(Math.random() * 100 > 50){
					black(j, i, ctx);
					black(list[j], i, ctx);
				}
			}
		}

		ctx.fillStyle = tmp;
	}

	$.fn.avatar = function(color = '#ffffff', bgColor = '#000000'){
		// console.table({color: color, bgColor: bgColor});
		var ctx = this[0].getContext('2d');
		generate(ctx, color, bgColor);
		
		return this;
	}
	debugger;
})($);

///// script.js /////
console.log('script loaded');
var intro = [];

$(document).ready(function(){
	next();
	$('#nameCard').click(next);
	$('#avatar').hide();

	data.forEach((item, index) => {
		$.ajax(`./intro/${item.intro}`).
			then((data) => {
				intro[index] = data;
			}).
			catch(() => {
				then[index] = 'fail to load introduction';
			});
	});
});

var index = 0;
var all = 16;

function next(){
	var person = data[index];
	var card = $('#nameCard');
	var ctx = card[0].getContext('2d');

	console.log(index);
	$('#nameCard').nameCard({
	//console.table({
		name: person.name,
		nickName: person.nickName,
		job: (function(job){
			var r = '';
			for(var i in job){
				r += job[i] + ' ';
			}
			return r;
		})(person.position)
	});
	
	$('#avatar').avatar();
	ctx.drawImage($('#avatar')[0], 100.5, 200.5, 256,256);
	
	///// 暫時的 /////
	var spot = [230, 280, 330, 380, 430, 480];
	for(var i in spot){
		var text = '';
		for(var j = 0; j < 18; j++){
			text += (Math.floor(Math.random() * 10));
		}
		ctx.fillText(text, 400, spot[i]);
	}

	index = (index + 1) % all; 
}

function previous(){

}
